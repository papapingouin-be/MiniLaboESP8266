<!DOCTYPE html>
<html lang="fr">
<!--
  udp.html

  Ce document est un squelette pour la configuration du service
  UDP. Il devrait permettre à l’utilisateur de choisir d’activer ou
  non l’émission et la réception UDP, de saisir le port d’écoute et la
  liste des IO à diffuser. La logique de chargement (GET
  /api/config?area=udp) et de sauvegarde (PUT /api/config?area=udp)
  reste à implémenter dans cette page et dans le firmware.
  TODO: compléter fetch et envoi JSON.
-->
<head>
  <meta charset="utf-8">
  <title>Configuration UDP – MiniLabo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Configuration UDP</h1>
  <form id="udp-form">
    <label><input type="checkbox" name="enabled"> Activer UDP</label><br>
    <label>Port: <input type="number" name="port" min="1" max="65535" value="12345"></label><br>
    <label>IO à diffuser (séparés par des virgules):<br>
      <input type="text" name="ios">
    </label><br>
    <button type="submit">Enregistrer</button>
  </form>
  <p id="status"></p>
  <script>
  async function loadUdpConfig() {
    try {
      const r = await fetch('/api/config?area=udp');
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const cfg = await r.json();
      document.querySelector('input[name="enabled"]').checked = cfg.enabled || false;
      document.querySelector('input[name="port"]').value = cfg.port || 12345;
      document.querySelector('input[name="ios"]').value = cfg.ios || '';
    } catch (e) {
      console.warn('Failed to load udp config', e);
      document.getElementById('status').textContent = 'Erreur de chargement.';
    }
  }
  async function saveUdpConfig(e) {
    e.preventDefault();
    const form = document.getElementById('udp-form');
    const data = {
      enabled: form.elements['enabled'].checked,
      port: parseInt(form.elements['port'].value),
      ios: form.elements['ios'].value.trim()
    };
    try {
      const r = await fetch('/api/config?area=udp', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      document.getElementById('status').textContent = 'Enregistré.';
    } catch (e) {
      console.warn(e);
      document.getElementById('status').textContent = 'Erreur.';
    }
  }
  document.getElementById('udp-form').addEventListener('submit', saveUdpConfig);
  loadUdpConfig();
  </script>
</body>
</html>