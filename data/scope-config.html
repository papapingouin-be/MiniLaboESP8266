<!DOCTYPE html>
<html lang="fr">
<!--
  scope-config.html

  Ce squelette de page est destiné à la configuration de l’oscilloscope.
  Il devrait permettre de sélectionner les canaux actifs, de définir
  l’échelle horizontale (base de temps) et verticale (V/div), ainsi
  qu’un offset. Le firmware devra exposer les IO disponibles via
  /api/io et les paramètres actuels via /api/config?area=scope.
  TODO: implémenter la logique JS pour charger et sauvegarder ces
  paramètres.
-->
<head>
  <meta charset="utf-8">
  <title>Configuration Oscilloscope – MiniLabo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Configuration Oscilloscope</h1>
  <form id="scope-form">
    <fieldset>
      <legend>Canal</legend>
      <select name="channel">
        <option value="CH1">CH1</option>
        <option value="CH2">CH2</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Base de temps</legend>
      <label>ms/div: <input type="number" name="timebase" value="10" min="1" max="1000"></label>
    </fieldset>
    <fieldset>
      <legend>Échelle verticale</legend>
      <label>V/div: <input type="number" name="vdiv" value="1.0" min="0.001" step="0.001"></label>
    </fieldset>
    <fieldset>
      <legend>Offset vertical</legend>
      <label>Offset: <input type="number" name="offset" value="0" step="0.1"></label>
    </fieldset>
    <button type="submit">Enregistrer</button>
  </form>
  <p id="status"></p>
  <script>
  async function loadScopeConfig() {
    try {
      const r = await fetch('/api/config?area=scope');
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const cfg = await r.json();
      document.querySelector('select[name="channel"]').value = cfg.channel || 'CH1';
      document.querySelector('input[name="timebase"]').value = cfg.timebase || 10;
      document.querySelector('input[name="vdiv"]').value = cfg.vdiv || 1.0;
      document.querySelector('input[name="offset"]').value = cfg.offset || 0.0;
    } catch (e) {
      console.warn('Failed to load scope config', e);
      document.getElementById('status').textContent = 'Erreur de chargement.';
    }
  }
  async function saveScopeConfig(e) {
    e.preventDefault();
    const form = document.getElementById('scope-form');
    const data = {
      channel: form.elements['channel'].value,
      timebase: parseInt(form.elements['timebase'].value),
      vdiv: parseFloat(form.elements['vdiv'].value),
      offset: parseFloat(form.elements['offset'].value)
    };
    try {
      const r = await fetch('/api/config?area=scope', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      document.getElementById('status').textContent = 'Enregistré.';
    } catch (e) {
      console.warn(e);
      document.getElementById('status').textContent = 'Erreur.';
    }
  }
  document.getElementById('scope-form').addEventListener('submit', saveScopeConfig);
  loadScopeConfig();
  </script>
</body>
</html>